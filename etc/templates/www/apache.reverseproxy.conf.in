<VirtualHost ${listen}:${port}>
ServerAdmin     kiorky@localhost
DocumentRoot    ${buildout:directory}
ServerName      ${host}
ErrorLog        ${buildout:directory}/var/log/apache/${host}_log
TransferLog     ${buildout:directory}/var/log/apache/${host}-access_log
CustomLog       ${buildout:directory}/var/log/apache/${host}-access_log combined
DirectoryIndex   index.html index.htm
<Directory "${buildout:directory}">
    Options  ExecCGI IncludesNOEXEC FollowSymLinks -Indexes
    AllowOverride All
    Order allow,deny
    Allow from all
</Directory>
ProxyRequests off
<Proxy *>
  Order allow,deny
  Allow from all
</Proxy>
RewriteEngine  on

# application mounted on / does not needs _vh_
# /zmiroot -> access to zmi
RewriteCond %{REQUEST_URI} ^(/zmiroot.*)$
RewriteRule      ^/zmiroot(.*) http://${hosts:zope-front}:${ports:zope-front}/VirtualHostBase/${scheme}/%{HTTP_HOST}:${port}/VirtualHostRoot/_vh_zmiroot$1 [L,P]

# /plone-testcgwb-> vhmonster direct access
RewriteCond %{REQUEST_URI} ^(/plone-testcgwb.*)$
RewriteRule      ^/plone-testcgwb(.*) http://${hosts:zope-front}:${ports:zope-front}/VirtualHostBase/${scheme}/%{HTTP_HOST}:${port}/${v:plonesite}/VirtualHostRoot/_vh_plone-testcgwb$1 [L,P]

# supervisor
ProxyPass         /supervisor/ http://${hosts:supervisor}:${ports:supervisor}/
ProxyPassReverse  /supervisor/ http://${hosts:supervisor}:${ports:supervisor}/

# /-> vhmonster proxyreverse because of redirects !
ProxyPass         /     http://${hosts:zope-front}:${ports:zope-front}/VirtualHostBase/${scheme}/${host}:${port}/${v:plonesite}/VirtualHostRoot/
ProxyPassReverse  /     http://${hosts:zope-front}:${ports:zope-front}/VirtualHostBase/${scheme}/${host}:${port}/${v:plonesite}/VirtualHostRoot/

#RewriteLog "${buildout:directory}/var/log/apache/rewrite.log"
#RewriteLogLevel 3


# vim: set ft=xml:
</VirtualHost>
<VirtualHost ${listen}:${port}>
ServerAdmin     kiorky@localhost
DocumentRoot    ${buildout:directory}
ServerName      ${edit-host}
ErrorLog        ${buildout:directory}/var/log/apache/${edit-host}_log
TransferLog     ${buildout:directory}/var/log/apache/${edit-host}-access_log
CustomLog       ${buildout:directory}/var/log/apache/${edit-host}-access_log combined
DirectoryIndex   index.html index.htm
<Directory "${buildout:directory}">
    Options  ExecCGI IncludesNOEXEC FollowSymLinks -Indexes
    AllowOverride All
    Order allow,deny
    Allow from all
</Directory>
ProxyRequests off
<Proxy *>
  Order allow,deny
  Allow from all
</Proxy>
RewriteEngine  on

# application mounted on / does not needs _vh_
# /zmiroot -> access to zmi
RewriteCond %{REQUEST_URI} ^(/zmiroot.*)$
RewriteRule      ^/zmiroot(.*) http://${hosts:zope-front}:${ports:zope-front}/VirtualHostBase/${scheme}/%{HTTP_HOST}:${port}/VirtualHostRoot/_vh_zmiroot$1 [L,P]

# /plone-testcgwb-> vhmonster direct access
RewriteCond %{REQUEST_URI} ^(/plone-testcgwb.*)$
RewriteRule      ^/plone-testcgwb(.*) http://${hosts:zope-front}:${ports:zope-front}/VirtualHostBase/${scheme}/%{HTTP_HOST}:${port}/${v:plonesite}/VirtualHostRoot/_vh_plone-testcgwb$1 [L,P]

# supervisor
ProxyPass         /supervisor/ http://${hosts:supervisor}:${ports:supervisor}/
ProxyPassReverse  /supervisor/ http://${hosts:supervisor}:${ports:supervisor}/

# /-> vhmonster proxyreverse because of redirects !
ProxyPass         /     http://${hosts:zope-front}:${ports:zope-front}/VirtualHostBase/${scheme}/${edit-host}:${port}/${v:plonesite}/VirtualHostRoot/
ProxyPassReverse  /     http://${hosts:zope-front}:${ports:zope-front}/VirtualHostBase/${scheme}/${edit-host}:${port}/${v:plonesite}/VirtualHostRoot/

#RewriteLog "${buildout:directory}/var/log/apache/rewrite.log"
#RewriteLogLevel 3


# vim: set ft=xml:
</VirtualHost> 
